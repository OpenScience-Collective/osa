# OSA Cloudflare Worker Configuration
# https://developers.cloudflare.com/workers/wrangler/configuration/

name = "osa-worker"
main = "index.js"
compatibility_date = "2024-01-01"

# Production environment (default)
[vars]
BACKEND_URL = "https://api.osc.earth/osa"
ENVIRONMENT = "production"

# Built-in rate limiting (free, no KV writes)
[[rate_limit]]
binding = "RATE_LIMITER"

# Development environment
[env.dev]
name = "osa-worker-dev"
vars = { BACKEND_URL = "https://api.osc.earth/osa-dev", ENVIRONMENT = "development" }

[[env.dev.rate_limit]]
binding = "RATE_LIMITER"

# =============================================================================
# Setup Instructions
# =============================================================================
#
# 1. Install wrangler:
#    npm install -g wrangler
#
# 2. Login to Cloudflare:
#    wrangler login
#
# 3. Set secrets (rate limiting is automatic, no setup needed):
#    wrangler secret put BACKEND_API_KEY
#    wrangler secret put TURNSTILE_SECRET_KEY
#    wrangler secret put BACKEND_API_KEY --env dev
#    wrangler secret put TURNSTILE_SECRET_KEY --env dev
#
# 4. Deploy:
#    wrangler deploy           # Production
#    wrangler deploy --env dev # Development
#
# 5. Verify:
#    curl https://osa-worker.<your-subdomain>.workers.dev/health
#
# =============================================================================
# Turnstile Setup
# =============================================================================
#
# 1. Go to Cloudflare Dashboard > Turnstile
# 2. Create a new widget with "Visible" mode
# 3. Add hostnames where the widget will be embedded:
#    - hedtags.org
#    - hed-examples.org
#    - localhost (for development)
# 4. Copy the Site Key (for frontend) and Secret Key (for this worker)
# 5. Set the secret key:
#    wrangler secret put TURNSTILE_SECRET_KEY
