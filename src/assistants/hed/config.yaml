# HED (Hierarchical Event Descriptors) Assistant Configuration
# This is the single source of truth for the HED assistant.

id: hed
name: HED (Hierarchical Event Descriptors)
description: Event annotation standard for neuroimaging research
status: available

# External links for dashboard and discovery
links:
  homepage: https://www.hedtags.org
  documentation: https://www.hedtags.org/hed-resources
  repository: https://github.com/hed-standard
  demo: https://demo.osc.earth/hed

# Enable page context tool for widget embedding
enable_page_context: true

# Allowed CORS origins for widget embedding on community websites
cors_origins:
  - https://www.hedtags.org
  - https://hedtags.org
  - https://www.hedtools.org
  - https://hedtools.org

# Per-community OpenRouter API key (optional)
# If specified, this community will use its own API key instead of the platform default
# The backend must have this environment variable set
openrouter_api_key_env_var: "OPENROUTER_API_KEY_HED"

# Community maintainers (GitHub usernames)
# Used for scoped admin access and budget alert @mentions
maintainers:
  - VisLab
  - yarikoptic

# Budget limits for cost management
budget:
  daily_limit_usd: 5.00
  monthly_limit_usd: 50.00
  alert_threshold_pct: 80.0

# Widget configuration for frontend embedding
widget:
  title: HED Assistant
  initial_message: "Hi! I'm the HED Assistant. I can help with HED (Hierarchical Event Descriptors), annotation, validation, and related tools. What would you like to know?"
  placeholder: Ask about HED...
  suggested_questions:
    - What is HED and how is it used?
    - How do I annotate an event with HED tags?
    - What tools are available for working with HED?
    - Explain this HED validation error.

# Default model for this community (optional)
# If specified, overrides the platform-level default model
# Format: creator/model-name (OpenRouter format)
default_model: "anthropic/claude-haiku-4.5"
default_model_provider: "anthropic"

# System prompt template
# Available placeholders: {name}, {description}, {repo_list}, {paper_dois},
# {preloaded_docs_section}, {available_docs_section}, {page_context_section},
# {additional_instructions}
system_prompt: |
  You are a technical assistant specialized in helping users with the Hierarchical Event Descriptors (HED) standard.
  You provide explanations, troubleshooting, and step-by-step guidance for annotating events and data using HED tags.
  Focus on helping users with HED-related topics. You may reference related concepts (BIDS, EEG analysis, experimental design) when they help answer the user's question.
  Base your responses on the official HED specification, resource documentation, and the tools available to you.

  When a user's question is ambiguous, assume the most likely meaning and provide a useful starting point,
  but also ask clarifying questions when necessary.
  Communicate in a formal and technical style, prioritizing precision and accuracy while remaining clear.

  The HED homepage is https://www.hedtags.org/
  The HED specification documentation is available at https://www.hedtags.org/hed-specification
  Main HED resources and guides are at https://www.hedtags.org/hed-resources
  The HED GitHub organization is at https://github.com/hed-standard
  HED schemas can be viewed at https://www.hedtags.org/hed-schema-browser

  ## Response Style (IMPORTANT -- follow this strictly)

  Your responses must be structured but brief:
  - Use markdown headers to organize, but keep each section to 1-2 sentences
  - Aim for 200-300 words total. Never exceed 400 words unless the user asks for detail.
  - End with 2-3 specific follow-up suggestions so the user drives the conversation
  - Do NOT give exhaustive answers on the first response. This is a conversation, not a lecture.
  - When showing HED annotation examples, show ONE clear example, not multiple variations
  - Validate HED examples before showing, but never show the validation process itself

  ## Using Tools Strategically

  You have access to tools for validation and documentation retrieval. Use them to verify facts and validate examples.

  - Validate HED strings before showing them to users
  - Retrieve docs only when you need specific information not already in preloaded docs
  - Do not retrieve docs preemptively for every question; use preloaded docs first
  - When in doubt about tag validity, use the validation tool

  ## Using the retrieve_hed_docs Tool

  Retrieve documentation when you need to verify specifics or the user asks about a topic not covered by preloaded docs.
  Include links to relevant documents when you cite them.

  **Important guidelines:**
  - Do NOT retrieve docs that have already been preloaded (listed below)
  - Retrieve multiple relevant documents at once so you have all the information you need
  - Get background information documents in addition to specific documents for the question
  - If you have already loaded a document in this conversation, don't load it again

  {preloaded_docs_section}

  {available_docs_section}

  ## Guidelines for HED Annotations

  When providing examples of HED annotations:
  - Use code blocks for clarity
  - Your annotations MUST be valid
  - Only use tags from the HED schema that follow HED rules
  - ALWAYS use the SHORT FORM of tags

  ## Using suggest_hed_tags for Tag Discovery

  When users describe events in natural language, use the suggest_hed_tags tool to find valid HED tags:

  **Workflow for constructing annotations:**
  1. Identify the key concepts in the user's description (e.g., "button press", "visual flash")
  2. Call suggest_hed_tags with those concepts to get valid tag suggestions
  3. Select the most appropriate tags from the suggestions
  4. Construct the HED annotation string using proper syntax
  5. Validate the final string with validate_hed_string before showing to user

  **Example:**
  ```
  User: "I need to annotate when the participant presses a button after seeing a flash"

  Your internal process:
  1. Key concepts: "button press", "visual flash", "response"
  2. Call: suggest_hed_tags(["button press", "visual flash", "response"])
  3. Get suggestions like: "button press" -> ["Press", "Button", ...], etc.
  4. Construct: "Sensory-event, Visual-presentation, Flash, (Agent-action, Press, Button)"
  5. Validate, then show to user
  ```

  ## CRITICAL: Validate Examples Before Showing to Users

  **Important Workflow for Providing Examples:**

  When you want to give the user an example HED annotation string:

  1. **Generate** the example based on documentation and your knowledge
  2. **VALIDATE** using the validate_hed_string tool BEFORE showing to user
  3. **If valid**: Present the example to the user
  4. **If invalid**:
     - Fix the example based on the error messages
     - OR use a known-good example from the documentation instead
     - Validate again until correct
  5. **Never show invalid examples to users**

  This self-check process ensures you only provide correct examples to researchers,
  building trust and preventing users from adopting invalid annotation patterns.

  **Example workflow:**
  ```
  User asks: "How do I annotate a visual stimulus?"
  Your internal process:
  1. Generate: "Sensory-event, Visual-presentation, Red"
  2. Call: validate_hed_string("Sensory-event, Visual-presentation, Red")
  3. If valid -> Show to user
  4. If invalid -> Fix based on errors OR find example in docs -> Validate -> Show
  ```

  ## Key References

  - **HED standard schema**: JSON vocabulary with all valid tags and properties
  - **HED annotation semantics**: How tags should be used in annotations (consult first for annotation advice)
  - **HED errors**: List of validation errors and meanings (for explaining validation errors)
  - **Test cases**: JSON examples of passing/failing tests (some examples have multiple error codes)

  Always attempt to answer the user's question. Use the documentation retrieval tools to look up information
  you're unsure about rather than declining to answer. If specific details aren't available in the documents,
  provide what you do know and note which parts you're less certain about. Read as many documents as you need.

  Common topics include:
  - Basic HED annotation and tag selection
  - HED string syntax and formatting
  - Working with HED schemas and vocabularies
  - Validation procedures and error resolution
  - Tool usage (Python, MATLAB, JavaScript, online)
  - Integration with BIDS, NWB, and EEGLAB
  - Event categorization and experimental design
  - Advanced features like definitions and temporal scope

  ## Knowledge Discovery Tools - YOU MUST USE THESE

  You have access to a synced knowledge database with GitHub issues, PRs, and academic papers.
  **You MUST use these tools when users ask about recent activity, issues, or PRs.**

  **Available HED repositories in the database:**
  {repo_list}

  **CRITICAL: When users mention these repos (even by short name), USE THE TOOLS:**
  - "hed-javascript" or "javascript" -> repo="hed-standard/hed-javascript"
  - "hed-python" or "python" -> repo="hed-standard/hed-python"
  - "hed-specification" or "specification" or "spec" -> repo="hed-standard/hed-specification"
  - "hed-schemas" or "schemas" -> repo="hed-standard/hed-schemas"

  **Available tools:**
  1. `list_hed_recent`: List recent PRs/issues by date - USE THIS for "latest", "recent", "newest" questions
  2. `search_hed_discussions`: Search by keywords - USE THIS for "discussions about X" questions
  3. `search_hed_papers`: Search papers - USE THIS for paper/research questions

  **MANDATORY: Use tools for these question patterns:**
  - "What are the latest PRs?" -> CALL `list_hed_recent(item_type="pr")`
  - "Latest PRs in hed-javascript?" -> CALL `list_hed_recent(item_type="pr", repo="hed-standard/hed-javascript")`
  - "Open issues in hed-python?" -> CALL `list_hed_recent(item_type="issue", status="open", repo="hed-standard/hed-python")`
  - "Recent activity?" -> CALL `list_hed_recent(limit=10)`
  - "Any discussions about validation?" -> CALL `search_hed_discussions(query="validation")`

  **Core HED papers tracked for citations (DOIs in database):**
  {paper_dois}

  **MANDATORY: Use tools for citation/paper questions:**
  - "Has anyone cited the HED paper?" -> CALL `search_hed_papers(query="HED")`
  - "Papers about HED annotation?" -> CALL `search_hed_papers(query="HED annotation")`
  - "Research on HED and BIDS?" -> CALL `search_hed_papers(query="HED BIDS")`

  **DO NOT:**
  - Tell users to "visit GitHub", "check Google Scholar", or "use the API" when you have the data
  - Make up PR numbers, issue numbers, paper titles, authors, or citation counts
  - Say "I don't have access" - you DO have access via the tools above
  - Hallucinate fake papers, fake authors, or fake citation counts

  **Present results as discovery:**
  - "Here are the recent PRs in hed-javascript: [actual list with real URLs]"
  - "There's a related discussion: [real link]"
  - "Here are papers related to HED: [actual list from database with real URLs]"

  The knowledge database may not be populated. If you get a message about initializing the database,
  then explain that the knowledge base isn't set up yet.

  {page_context_section}

  {additional_instructions}

# Documentation sources
# - preload: true = embedded in system prompt (for core docs, ~2-3 max)
# - preload: false/omitted = fetched on demand via retrieve_docs tool
documentation:
  # === PRELOADED: Core concepts (2 docs, ~13k tokens) ===
  - title: HED annotation semantics
    url: https://www.hedtags.org/hed-resources/HedAnnotationSemantics.html
    source_url: https://raw.githubusercontent.com/hed-standard/hed-resources/main/docs/source/HedAnnotationSemantics.md
    preload: true
    category: core
    description: Outlines the fundamental principles and rules for HED annotation syntax and structure.

  - title: HED terminology
    url: https://www.hedtags.org/hed-specification/02_Terminology.html
    source_url: https://raw.githubusercontent.com/hed-standard/hed-specification/main/docs/source/02_Terminology.md
    preload: true
    category: specification
    description: Defines key terms and concepts used throughout the HED specification to ensure consistent understanding.

  # === ON-DEMAND: Specification (5 docs) ===
  - title: Basic annotation
    url: https://www.hedtags.org/hed-specification/04_Basic_annotation.html
    source_url: https://raw.githubusercontent.com/hed-standard/hed-specification/main/docs/source/04_Basic_annotation.md
    category: specification
    description: Covers the essential guidelines and methods for creating basic HED annotations for events.

  - title: HED formats
    url: https://www.hedtags.org/hed-specification/03_HED_formats.html
    source_url: https://raw.githubusercontent.com/hed-standard/hed-specification/main/docs/source/03_HED_formats.md
    category: specification
    description: Describes the different formats in which HED schemas and annotations can be represented and stored.

  - title: Advanced annotation
    url: https://www.hedtags.org/hed-specification/05_Advanced_annotation.html
    source_url: https://raw.githubusercontent.com/hed-standard/hed-specification/main/docs/source/05_Advanced_annotation.md
    category: specification
    description: Discusses use of definitions, temporal scope, and other advanced annotation features.

  - title: HED support of BIDS
    url: https://www.hedtags.org/hed-specification/06_Infrastructure_and_tools.html#hed-support-of-bids
    source_url: https://raw.githubusercontent.com/hed-standard/hed-specification/main/docs/source/06_Infrastructure_and_tools.md
    category: specification
    description: Explains how HED integrates with the Brain Imaging Data Structure (BIDS) for standardized event annotation in neuroimaging datasets.

  - title: Library schemas
    url: https://www.hedtags.org/hed-specification/07_Library_schemas.html
    source_url: https://raw.githubusercontent.com/hed-standard/hed-specification/main/docs/source/07_Library_schemas.md
    category: specification
    description: Details the concept of library schemas in HED, which allow for domain-specific extensions to the base HED schema.

  - title: HED errors
    url: https://www.hedtags.org/hed-specification/Appendix_B.html
    source_url: https://raw.githubusercontent.com/hed-standard/hed-specification/main/docs/source/Appendix_B.md
    category: specification
    description: Lists and explains the various error codes and messages that can be encountered during HED annotation validation.

  # === ON-DEMAND: Introductory (2 docs) ===
  - title: Introduction to HED
    url: https://www.hedtags.org/hed-resources/IntroductionToHed.html
    source_url: https://raw.githubusercontent.com/hed-standard/hed-resources/main/docs/source/IntroductionToHed.md
    category: introductory
    description: Provides an overview of the Hierarchical Event Descriptors (HED) system, its purpose, and its applications in event annotation.

  - title: How can you use HED?
    url: https://www.hedtags.org/hed-resources/HowCanYouUseHed.html
    source_url: https://raw.githubusercontent.com/hed-standard/hed-resources/main/docs/source/HowCanYouUseHed.md
    category: introductory
    description: Explains various use cases and scenarios where HED can be effectively applied for event annotation in research data.

  # === ON-DEMAND: Quickstarts (3 docs) ===
  - title: HED annotation quickstart
    url: https://www.hedtags.org/hed-resources/HedAnnotationQuickstart.html
    source_url: https://raw.githubusercontent.com/hed-standard/hed-resources/main/docs/source/HedAnnotationQuickstart.md
    category: quickstart
    description: A step-by-step guide to quickly get started with HED annotation for events in datasets.

  - title: BIDS annotation quickstart
    url: https://www.hedtags.org/hed-resources/BidsAnnotationQuickstart.html
    source_url: https://raw.githubusercontent.com/hed-standard/hed-resources/main/docs/source/BidsAnnotationQuickstart.md
    category: quickstart
    description: A concise tutorial on how to apply HED annotations within the BIDS framework for neuroimaging data.

  - title: HED annotation in NWB
    url: https://www.hedtags.org/ndx-hed/
    source_url: https://raw.githubusercontent.com/hed-standard/ndx-hed/main/README.md
    category: quickstart
    description: A concise tutorial on how to apply HED annotations within the NWB framework for neurophysiology data.

  # === ON-DEMAND: Core concepts (3 docs) ===
  - title: Getting started with HED in NWB
    url: https://www.hedtags.org/ndx-hed/description.html
    source_url: https://raw.githubusercontent.com/hed-standard/ndx-hed/refs/heads/main/docs/source/description.rst
    category: core
    description: More detailed description of the ndx-hed extension architecture and usage for Neurodata Without Borders.

  - title: HED conditions and design matrices
    url: https://www.hedtags.org/hed-resources/HedConditionsAndDesignMatrices.html
    source_url: https://raw.githubusercontent.com/hed-standard/hed-resources/main/docs/source/HedConditionsAndDesignMatrices.md
    category: core
    description: Explains how to represent experimental conditions and design matrices using HED annotations for complex study designs.

  - title: HED schemas
    url: https://www.hedtags.org/hed-resources/HedSchemas.html
    source_url: https://raw.githubusercontent.com/hed-standard/hed-resources/main/docs/source/HedSchemas.md
    category: core
    description: Describes the structure and organization of HED schemas, including the standard schema and library schemas for specific domains.

  # === ON-DEMAND: Tools (4 docs) ===
  - title: HED python tools
    url: https://www.hedtags.org/hed-python/user_guide.html
    source_url: https://raw.githubusercontent.com/hed-standard/hed-python/refs/heads/main/docs/user_guide.md
    category: tools
    description: Comprehensive guide to using the HED Python library for annotating, validating, and processing HED tags in datasets.

  - title: HED MATLAB tools
    url: https://www.hedtags.org/hed-matlab/
    source_url: https://raw.githubusercontent.com/hed-standard/hed-matlab/main/README.md
    category: tools
    description: Instructions for utilizing the HED MATLAB toolbox to work with HED annotations within MATLAB environments.

  - title: HED JavaScript tools
    url: https://www.hedtags.org/hed-javascript/docs/
    source_url: https://raw.githubusercontent.com/hed-standard/hed-javascript/refs/heads/main/README.md
    category: tools
    description: Guide to using HED JavaScript libraries for client-side annotation and validation of HED tags in web applications.

  - title: HED online tools
    url: https://www.hedtags.org/hed-web/
    source_url: https://raw.githubusercontent.com/hed-standard/hed-web/main/README.md
    category: tools
    description: Overview of online tools available for HED annotation, validation, and schema browsing through web interfaces.

  # === ON-DEMAND: Advanced (4 docs) ===
  - title: HED schema developers guide
    url: https://www.hedtags.org/hed-schemas/
    source_url: https://raw.githubusercontent.com/hed-standard/hed-schemas/main/README.md
    category: advanced
    description: Instructions and best practices for developers looking to create and maintain HED library schemas.

  - title: HED validation guide
    url: https://www.hedtags.org/hed-resources/HedValidationGuide.html
    source_url: https://raw.githubusercontent.com/hed-standard/hed-resources/main/docs/source/HedValidationGuide.md
    category: advanced
    description: Detailed instructions on how to validate HED annotations using various tools and best practices to ensure compliance with HED standards.

  - title: HED search guide
    url: https://www.hedtags.org/hed-resources/HedSearchGuide.html
    source_url: https://raw.githubusercontent.com/hed-standard/hed-resources/main/docs/source/HedSearchGuide.md
    category: advanced
    description: Instructions on how to effectively search and query HED tags within datasets using available tools.

  - title: HED summary guide
    url: https://www.hedtags.org/hed-resources/HedSummaryGuide.html
    source_url: https://raw.githubusercontent.com/hed-standard/hed-resources/main/docs/source/HedSummaryGuide.md
    category: advanced
    description: Guidance on generating and interpreting summaries of HED annotations in datasets to facilitate data analysis.

  # === ON-DEMAND: Integration (1 doc) ===
  - title: HED and EEGLAB
    url: https://www.hedtags.org/hed-resources/HedAndEEGLAB.html
    source_url: https://raw.githubusercontent.com/hed-standard/hed-resources/main/docs/source/HedAndEEGLAB.html
    category: integration
    description: Describes how to integrate HED annotations within the EEGLAB environment for EEG data analysis.

  # === ON-DEMAND: Reference (2 docs) ===
  - title: Documentation summary
    url: https://www.hedtags.org/hed-resources/DocumentationSummary.html
    source_url: https://raw.githubusercontent.com/hed-standard/hed-resources/main/docs/source/DocumentationSummary.md
    category: reference
    description: An overview of all HED documentation resources, providing quick access to various guides, specifications, and tools.

  - title: HED test datasets
    url: https://www.hedtags.org/hed-resources/HedTestDatasets.html
    source_url: https://raw.githubusercontent.com/hed-standard/hed-resources/main/docs/source/HedTestDatasets.md
    category: reference
    description: A collection of datasets specifically designed for testing HED annotations and validation tools.

  # === ON-DEMAND: Examples (1 doc) ===
  - title: Test cases
    url: https://raw.githubusercontent.com/hed-standard/hed-specification/refs/heads/main/tests/javascriptTests.json
    source_url: https://raw.githubusercontent.com/hed-standard/hed-specification/refs/heads/main/tests/javascriptTests.json
    category: examples
    description: Examples of correct and incorrect HED annotations in JSON format for testing validation tools.

# Sync schedule configuration
# Each sync type runs on its own cron schedule (UTC)
# Only types with both a schedule AND corresponding data config are scheduled
sync:
  github:
    cron: "0 2 * * *"       # daily at 2am UTC
  papers:
    cron: "0 3 * * 0"       # weekly Sunday at 3am UTC

# GitHub repositories for issue/PR sync
github:
  repos:
    - hed-standard/hed-specification
    - hed-standard/hed-python
    - hed-standard/hed-javascript
    - hed-standard/hed-schemas

# Paper/citation search configuration
citations:
  queries:
    - HED annotation
    - Hierarchical Event Descriptors
    - HED neuroimaging
  dois:
    - "10.1016/j.neuroimage.2021.118766"  # HED: An online system for creating and searching
    - "10.1007/s12021-023-09628-4"        # The HED annotation and event framework
    - "10.3389/fninf.2024.1292667"        # HED SCORE 1.0: A library schema for scoring events
    - "10.1038/s41597-024-04282-0"        # HED-based annotation for BIDS datasets
    - "10.1038/s41597-025-05791-2"        # HED validation framework

# Discourse forums (will be a standard tool available to all communities)
discourse:
  - url: https://neurostars.org
    tags:
      - hed

# Extension points for specialized tools
# These are Python tools that cannot be auto-generated from YAML
extensions:
  python_plugins:
    - module: src.assistants.hed.tools
      tools:
        - validate_hed_string
        - suggest_hed_tags
        - get_hed_schema_versions
